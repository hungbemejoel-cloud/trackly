<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>2_index - Link Tracker (Pill UI)</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    :root{
      --brand-blue: #004aad;
      --brand-gold: #fbbf24;
      --pill-bg: #fff;
      --page-bg: #f3f6fa;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--page-bg);color:#222}
    header{background:linear-gradient(90deg,var(--brand-blue),#0f63b8 50%,var(--brand-gold));color:#fff;padding:14px;text-align:center;font-weight:700;font-size:1.1rem}
    .wrapper{max-width:900px;margin:20px auto;padding:0 16px}
    #built{text-align:center;color:#555;margin-bottom:12px}
    textarea{width:100%;min-height:110px;padding:12px;border-radius:10px;border:1.5px solid rgba(0,74,173,0.15);background:#fff;font-size:14px}
    .controls{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
    button,.file-label{background:var(--brand-blue);color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer;font-size:0.95rem}
    button:hover{opacity:.95}
    input[type=file]{display:none}
    #counter{margin-top:10px;text-align:center;font-weight:700;color:var(--brand-blue)}
    #progress{width:100%;height:10px;background:#e6e9ee;border-radius:12px;overflow:hidden;margin-top:8px}
    #progress-bar{height:100%;width:0%;background:var(--brand-gold);transition:width .35s ease}

    /* pill layout */
    .pill-container{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}
    .pill{background:var(--pill-bg);border-radius:50px;padding:10px 16px;display:flex;align-items:center;gap:12px;box-shadow:0 2px 6px rgba(0,0,0,0.08);width:100%}
    .pill .badge{background:#f2f6ff;color:var(--brand-blue);font-weight:700;padding:6px 10px;border-radius:20px;font-size:0.9rem;flex:0 0 auto}
    .pill .domain{font-weight:700;color:var(--brand-blue);word-break:break-word;flex:1 1 auto;min-width:0}
    .pill-actions{margin-left:auto;display:flex;gap:8px;align-items:center;flex:0 0 auto}
    .open-btn{background:var(--brand-blue);color:#fff;border-radius:20px;padding:6px 12px;text-decoration:none;font-size:0.85rem;font-weight:700}
    .copy-btn{background:#fff;color:var(--brand-blue);border:1px solid rgba(0,74,173,0.2);border-radius:20px;padding:6px 12px;font-size:0.85rem;font-weight:700}
    .clicked{color:#7b2fa6;font-weight:700;font-size:0.85rem;min-width:64px;text-align:right}

    footer{text-align:center;margin-top:20px;color:#666}

    #topBtn{display:none;position:fixed;bottom:20px;right:20px;z-index:99;background:var(--brand-blue);color:#fff;border:none;padding:12px 14px;border-radius:50%;cursor:pointer;font-size:18px;box-shadow:0 4px 8px rgba(0,0,0,0.25)}
    #topBtn:hover{opacity:.9}
    @media (max-width:640px){
      .pill-container{gap:8px}
      .pill{padding:8px 12px;gap:8px}
      .pill .domain{font-size:14px}
      button,.file-label{font-size:.92rem;padding:9px 12px}
    }
  </style>
</head>
<body>
<header>üöÄ Link Tracker ‚Äî Pill View</header>

<div class="wrapper">
  <div id="built">Built with ‚ù§Ô∏è by YourBrand</div>

  <textarea id="linkInput" placeholder="Paste one URL per line (example.com or https://example.com)"></textarea>

  <div class="controls">
    <button onclick="render()">Update Links</button>
    <button onclick="clearAll()">Clear All</button>
    <label class="file-label" for="fileInput">Import File</label>
    <input id="fileInput" type="file" accept=".txt" onchange="importFile(event)">
    <button onclick="toggleView(false)">Show All</button>
    <button onclick="toggleView(true)">Show Unclicked</button>
    <button onclick="window.location.href='2_extract_domains.html'">Extract Domain</button>
  </div>

  <div id="counter"></div>
  <div id="progress"><div id="progress-bar"></div></div>

  <div id="linksContainer" class="pill-container" aria-live="polite"></div>

  <footer>Built with üíô + üíõ by YourBrand</footer>
</div>

<button onclick="topFunction()" id="topBtn" title="Go to top">‚Üë</button>

<script>
/* ======= State & utilities ======= */
const linkInput = document.getElementById('linkInput');
const linksContainer = document.getElementById('linksContainer');
const counterDiv = document.getElementById('counter');
const progressBar = document.getElementById('progress-bar');
const topBtn = document.getElementById('topBtn');

let clickedLinks = new Set(JSON.parse(localStorage.getItem('clickedLinks') || '[]'));
let showOnlyUnclicked = false;

/* Restore textarea persistently */
const savedText = localStorage.getItem('savedTextArea');
if (savedText) linkInput.value = savedText;

/* Restore from extractor if present */
const savedFromExtractor = localStorage.getItem('savedLinks');
if (savedFromExtractor) {
  linkInput.value = savedFromExtractor;
  localStorage.removeItem('savedLinks');
}

/* Normalize and keep order while deduping */
function normalizeUrl(raw){
  if (!raw) return null;
  let s = raw.trim();
  if (!s) return null;
  if (!/^https?:\/\//i.test(s)) s = 'https://' + s.replace(/^\/+/, '');
  return s;
}
function orderedUnique(arr){
  const seen = new Set();
  const out = [];
  for(const item of arr){
    if (!seen.has(item)){
      seen.add(item);
      out.push(item);
    }
  }
  return out;
}

/* ======= Render pills ======= */
function render(){
  const lines = linkInput.value.split(/\r?\n/).map(normalizeUrl).filter(Boolean);
  const rawLinks = orderedUnique(lines);

  linksContainer.innerHTML = '';
  if (rawLinks.length === 0){
    linksContainer.style.display = 'none';
    counterDiv.textContent = '';
    progressBar.style.width = '0%';
    return;
  } else {
    linksContainer.style.display = 'flex';
  }

  rawLinks.forEach((url, index) => {
    if (showOnlyUnclicked && clickedLinks.has(url)) return;

    const pill = document.createElement('div');
    pill.className = 'pill';

    const badge = document.createElement('div');
    badge.className = 'badge';
    badge.textContent = index + 1;

    const domain = document.createElement('div');
    domain.className = 'domain';
    try { domain.textContent = new URL(url).hostname; }
    catch(e) { domain.textContent = url; }

    const actions = document.createElement('div');
    actions.className = 'pill-actions';

    const openA = document.createElement('a');
    openA.className = 'open-btn';
    openA.href = url;
    openA.target = '_blank';
    openA.rel = 'noopener noreferrer';
    openA.textContent = 'Open';
    openA.addEventListener('click', () => markClicked(url));

    const copyBtn = document.createElement('button');
    copyBtn.className = 'copy-btn';
    copyBtn.textContent = 'Copy';
    copyBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      navigator.clipboard.writeText(url).then(() => {
        copyBtn.textContent = 'Copied';
        copyBtn.classList.add('copied');
        setTimeout(()=> { copyBtn.textContent = 'Copy'; copyBtn.classList.remove('copied'); }, 900);
      }).catch(()=> alert('Copy failed'));
    });

    const clickedIndicator = document.createElement('div');
    clickedIndicator.className = 'clicked';
    clickedIndicator.textContent = clickedLinks.has(url) ? '‚úì Clicked' : '';

    actions.append(openA, copyBtn, clickedIndicator);
    pill.append(badge, domain, actions);
    linksContainer.appendChild(pill);
  });

  updateCounterAndProgress(orderedUnique(linkInput.value.split(/\r?\n/).map(normalizeUrl).filter(Boolean)));
}

/* ======= Mark clicked & persistence ======= */
function markClicked(url){
  if (!clickedLinks.has(url)){
    clickedLinks.add(url);
    localStorage.setItem('clickedLinks', JSON.stringify(Array.from(clickedLinks)));
  }
  render();

  const rawLinks = orderedUnique(linkInput.value.split(/\r?\n/).map(normalizeUrl).filter(Boolean));
  const allClicked = rawLinks.length > 0 && rawLinks.every(l => clickedLinks.has(l));
  if (allClicked) {
    confetti({ particleCount: 90, spread: 70, origin: { y: 0.6 } });
  }
}

/* ======= Counter & progress ======= */
function updateCounterAndProgress(rawLinks){
  const total = rawLinks.length;
  const clickedCount = rawLinks.filter(u => clickedLinks.has(u)).length;
  const unclicked = total - clickedCount;
  if (total === 0) {
    counterDiv.textContent = '';
    progressBar.style.width = '0%';
  } else {
    counterDiv.textContent = `Progress: ${clickedCount}/${total} clicked ‚Äî ${unclicked} left`;
    const pct = Math.round((clickedCount / total) * 100);
    progressBar.style.width = pct + '%';
  }
}

/* ======= File import (append + dedupe) ======= */
function importFile(event){
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e){
    const content = e.target.result;
    const existing = linkInput.value.split(/\r?\n/);
    const fromFile = content.split(/\r?\n/);
    const combined = orderedUnique(existing.concat(fromFile).map(normalizeUrl).filter(Boolean));
    linkInput.value = combined.join('\n');
    localStorage.setItem('savedTextArea', linkInput.value);
    render();
    event.target.value = '';
  };
  reader.readAsText(file);
}

/* ======= Helpers ======= */
function toggleView(unclickedOnly){ showOnlyUnclicked = unclickedOnly; render(); }
function clearAll(){ linkInput.value = ''; localStorage.removeItem('savedTextArea'); render(); }

/* persist textarea input */
linkInput.addEventListener('input', () => {
  localStorage.setItem('savedTextArea', linkInput.value);
  render();
});

/* initial render */
render();

/* scroll-to-top button logic */
window.onscroll = function(){
  if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200){
    topBtn.style.display = "block";
  } else {
    topBtn.style.display = "none";
  }
};
function topFunction(){ window.scrollTo({ top: 0, behavior: 'smooth' }); }
</script>
</body>
</html>